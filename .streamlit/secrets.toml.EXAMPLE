# =============================================================================
# SIRAYA Health Navigator - Secrets Configuration Template
# =============================================================================
# Copia questo file in .streamlit/secrets.toml e riempi con le tue chiavi

# =============================================================================
# ANALYTICS DASHBOARD - Password Admin
# =============================================================================
# PASSWORD PREDEFINITA: "ciaociao"
# Per cambiarla, decommenta e modifica:
# BACKEND_PASSWORD = "tua_password_personalizzata"

# OPZIONALE - Se non impostato, usa la password predefinita "ciaociao"
# BACKEND_PASSWORD = "ciaociao"

# =============================================================================
# API KEYS - AI Models
# =============================================================================
[groq]
api_key = "gsk_your_groq_key_here"

[gemini]
api_key = "AIza_your_gemini_key_here"

# =============================================================================
# SUPABASE - Database Cloud
# =============================================================================
# IMPORTANTE: Usa la SERVICE_ROLE KEY (non Anon Key) per poter scrivere logs
# La SERVICE_ROLE KEY bypassa RLS (Row Level Security) policies
SUPABASE_URL = "https://your-project.supabase.co"
SUPABASE_KEY = "eyJ_your_SERVICE_ROLE_key_here"

# Formato alternativo (anche supportato):
# [supabase]
# url = "https://your-project.supabase.co"
# key = "eyJ_your_SERVICE_ROLE_key_here"

# =============================================================================
# COME TROVARE LE CHIAVI
# =============================================================================
# 1. GROQ API Key:
#    - Vai su: https://console.groq.com/keys
#    - Clicca "Create API Key"
#    - Copia la chiave (inizia con "gsk_")
#
# 2. GEMINI API Key:
#    - Vai su: https://aistudio.google.com/app/apikey
#    - Clicca "Create API Key"
#    - Copia la chiave (inizia con "AIza")
#
# 3. SUPABASE:
#    - Vai su: https://supabase.com/dashboard
#    - Seleziona il tuo progetto
#    - Settings → API
#    - Project URL: copia l'URL completo
#    - service_role key: copia la chiave (NON la anon key!)
#      ⚠️ IMPORTANTE: Usa "service_role" key, NON "anon" key
#      La service_role key è necessaria per scrivere nei logs
#
# =============================================================================
# CONFIGURAZIONE RLS (Row Level Security) SUPABASE
# =============================================================================
# Se i log non vengono scritti, verifica le RLS policies su Supabase:
# 
# 1. Vai su Supabase Dashboard → SQL Editor
# 2. Esegui questo SQL:
#
#    -- Abilita RLS sulla tabella
#    ALTER TABLE triage_logs ENABLE ROW LEVEL SECURITY;
#    
#    -- Policy per INSERT (permetti tutti gli inserimenti)
#    CREATE POLICY "Enable insert for all users" 
#    ON triage_logs 
#    FOR INSERT 
#    WITH CHECK (true);
#    
#    -- Policy per SELECT (permetti tutte le letture)
#    CREATE POLICY "Enable read for all users" 
#    ON triage_logs 
#    FOR SELECT 
#    USING (true);
#
# 3. Verifica che le policies siano attive:
#    SELECT * FROM pg_policies WHERE tablename = 'triage_logs';
#
# =============================================================================
# STRUTTURA TABELLA triage_logs
# =============================================================================
# La tabella deve avere questa struttura:
#
# CREATE TABLE triage_logs (
#   id BIGSERIAL PRIMARY KEY,
#   session_id TEXT NOT NULL,
#   user_input TEXT,
#   bot_response TEXT,
#   metadata JSONB,
#   processing_time_ms INTEGER,
#   created_at TIMESTAMP WITH TIME ZONE DEFAULT now()
# );
#
# CREATE INDEX idx_triage_logs_session ON triage_logs(session_id);
# CREATE INDEX idx_triage_logs_created ON triage_logs(created_at);
#
# =============================================================================
# TESTING
# =============================================================================
# Per testare la configurazione:
# 1. Salva questo file come .streamlit/secrets.toml con le tue chiavi
# 2. Avvia Streamlit: streamlit run siraya/app.py
# 3. Verifica nella sidebar "Stato Sistema":
#    - Deve mostrare "✅ Database Connesso"
#    - Deve mostrare "✅ AI Disponibile"
# 4. Fai una conversazione di test
# 5. Vai su Supabase Dashboard → Table Editor → triage_logs
# 6. Verifica che i log siano stati scritti
#
# =============================================================================
# SICUREZZA
# =============================================================================
# ⚠️ NON COMMITTARE QUESTO FILE CON LE CHIAVI REALI!
# Il file .streamlit/secrets.toml è già in .gitignore
# Usa questo file SOLO come template di riferimento
#
# Per produzione, configura i secrets su:
# - Streamlit Cloud: Dashboard → Settings → Secrets
# - Altri hosting: Variabili d'ambiente o secrets manager
